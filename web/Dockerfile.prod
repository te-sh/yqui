FROM node:14.15.4-alpine3.12 AS builder

USER node
ENV HOME /home/node

ENV APPDIR $HOME/app
RUN mkdir -p $APPDIR
WORKDIR $APPDIR

ADD . ./
RUN yarn install \
 && yarn build

FROM node:14.15.4-alpine3.12

USER node
ENV HOME /home/node

ENV APPDIR $HOME/app
RUN mkdir -p $APPDIR
WORKDIR $APPDIR

RUN apk update \
 && apk upgrade \
 && rm -rf /var/cache/apk/* \
 && yarn global add serve \
 && yarn cache clean

COPY --from=builder $APPDIR/build ./build

CMD ["serve", "-s", "build"]
